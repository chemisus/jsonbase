/*! jsonbase 14-02-2014 */
function Environment(a,b){var c=[null];this.record=function(){return c[c.length-1]},this.pushRecord=function(a){c.push(a)},this.popRecord=function(){return c.pop()},this.execute=function(a){return this.operation(a[0]).execute(a,this)},this.operation=function(b){return a[b]},this.availableOperations=function(){var b=[];for(var c in a)b.push(c);return b},this.queryBuilder=function(){return b.make(this)}}function EnvironmentFactory(){this.make=function(a){return a=a||{},new Environment(a.operations||this.makeOperations(),a.query_builder_factory||new QueryBuilderFactory)},this.makeOperations=function(){return{"true":new TrueOperation,"false":new FalseOperation,"const":new ConstOperation,not:new NotOperation,record:new RecordOperation,map:new MapOperation,eq:new EqualOperation}}}function ConstOperation(){this.make=function(a){return["const",a]},this.execute=function(a){return a[1]}}function EqualOperation(){this.make=function(a,b){return["eq",a,b]},this.execute=function(a,b){var c=b.execute(a[1]),d=b.execute(a[2]);return c==d}}function FalseOperation(){this.make=function(){return["false"]},this.execute=function(){return!1}}function MapOperation(){this.make=function(a,b){return["map",a,b]},this.execute=function(a,b){return b.execute(a[1]).map(function(c){b.pushRecord(c);var d=b.execute(a[2]);return b.popRecord(),d})}}function NotOperation(){this.make=function(a){return["not",a]},this.execute=function(a,b){return!b.execute(a[1])}}function RecordOperation(){this.make=function(){return["record"]},this.execute=function(a,b){return b.record()}}function TrueOperation(){this.make=function(){return["true"]},this.execute=function(){return!0}}function QueryBuilder(a){for(var b=a.availableOperations(),c=0;c<b.length;c++)this[b[c]]=a.operation(b[c]).make}function QueryBuilderFactory(){this.make=function(a){return new QueryBuilder(a)}}